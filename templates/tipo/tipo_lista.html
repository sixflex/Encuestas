{% extends "main_base.html" %}

{% block title %}Gestión de Tipos de Incidencia | Gestión Municipal{% endblock %}

{% block dashboard_content %}
<h1 class="h3 mb-4">Gestión de Tipos de Incidencia</h1>

<div class="mb-3">
    <a href="{% url 'incidencias:tipo_crear' %}" class="btn btn-success">
        <i class="bi bi-plus-lg"></i> Nuevo Tipo
    </a>
</div>

<table class="table table-striped" style="width: 100%;">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nombre Problema</th>
            <th>Descripción</th>
            <th>Gravedad</th>
            <th>Preguntas Base</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for tipo in tipos %}
        <tr>
            <td>{{ tipo.id }}</td>
            <td><strong>{{ tipo.nombre_problema }}</strong></td>
            <td>{{ tipo.descripcion }}</td>
            <td>{{ tipo.tipo_gravedad }}</td>
            <td>{{ tipo.preguntas_base.count }} pregunta(s)</td>
            <td>
                <a href="{% url 'incidencias:tipo_editar' tipo.id %}" class="btn btn-sm btn-warning"> Editar</a>
                <a href="{% url 'incidencias:tipo_eliminar' tipo.id %}" class="btn btn-sm btn-danger"> Eliminar</a>
                <a href="{% url 'incidencias:pregunta_base_crear' tipo.id %}" class="btn btn-sm btn-primary">+ Agregar Pregunta Base</a>
                <a href="{% url 'incidencias:preguntas_base_lista' tipo.id %}" class="btn btn-sm btn-secondary"> Ver Preguntas</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center">No hay tipos de incidencia.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
<div class="card shadow-sm border-0 rounded-3">
    <div class="card-body">
        <div class="table-responsive">
            {% if tipos %}
            <table class="table table-striped table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Nombre Problema</th>
                        <th>Descripción</th>
                        <th>Gravedad</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tipo in tipos %}
                    <tr>
                        <td>{{ tipo.id }}</td>
                        <td>{{ tipo.nombre_problema }}</td>
                        <td>{{ tipo.descripcion|default:"-" }}</td>
                        <td>{{ tipo.tipo_gravedad|default:"-" }}</td>
                        <td classd="d-flex flex-wrap gap-2">
                            {# Había un error en tu código original, este botón estaba duplicado #}
                            {# <li><a href="{% url 'incidencias:tipo_crear' %}">Crear Nuevo Tipo de Incidencia</a></li> #}
                            <a href="{% url 'incidencias:tipo_editar' tipo.id %}" class="btn btn-sm btn-info">Editar</a>
                            <a href="{% url 'incidencias:tipo_eliminar' tipo.id %}" class="btn btn-sm btn-danger">Eliminar</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">No hay tipos de incidencia.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="alert alert-info" role="alert">
                No hay tipos de incidencia registrados.
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
